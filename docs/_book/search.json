[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "kabacloj",
    "section": "",
    "text": "(ns index\n  (:require [tablecloth.api :as tc]\n            [tablecloth.column.api :as tcc]\n            [scicloj.noj.v1.vis.hanami :as hanami]\n            [aerial.hanami.templates :as ht]\n            [tech.v3.dataset.categorical :as ds-cat]\n            [tech.v3.dataset.modelling :as ds-mod]\n            [tech.v3.dataset.column-filters :as cf]\n            [scicloj.kindly.v4.kind :as kind]\n            [scicloj.metamorph.core :as morph]\n            [tablecloth.api.split :as split]\n            [scicloj.metamorph.ml :as ml]\n            [tech.v3.dataset :as tds]\n            [camel-snake-kebab.core :as csk]\n            [scicloj.metamorph.ml.loss :as loss]\n            [scicloj.ml.smile.classification]))\n\n\n0.0.0.1 Fetching data\n\n(def ds\n  (-&gt; \"data/index.csv\"\n      (tc/dataset {:key-fn keyword})))\n\n\n(tc/unique-by ds :coffee_name)\n\n\ndata/index.csv [8 6]:\n\n\n\n\n\n\n\n\n\n\n\n:date\n:datetime\n:cash_type\n:card\n:money\n:coffee_name\n\n\n\n\n2024-03-01\n2024-03-01 10:15:50.520\ncard\nANON-0000-0000-0001\n38.7\nLatte\n\n\n2024-03-01\n2024-03-01 12:19:22.539\ncard\nANON-0000-0000-0002\n38.7\nHot Chocolate\n\n\n2024-03-01\n2024-03-01 13:46:33.006\ncard\nANON-0000-0000-0003\n28.9\nAmericano\n\n\n2024-03-01\n2024-03-01 15:39:47.726\ncard\nANON-0000-0000-0005\n33.8\nAmericano with Milk\n\n\n2024-03-01\n2024-03-01 19:22:01.762\ncard\nANON-0000-0000-0008\n38.7\nCocoa\n\n\n2024-03-03\n2024-03-03 11:33:56.118\ncard\nANON-0000-0000-0016\n28.9\nCortado\n\n\n2024-03-04\n2024-03-04 14:04:37.734\ncard\nANON-0000-0000-0022\n24.0\nEspresso\n\n\n2024-03-06\n2024-03-06 14:52:01.761\ncard\nANON-0000-0000-0029\n38.7\nCappuccino\n\n\n\n\n\n\n0.0.0.2 Feature engineering\n\n(defn coffee-has-milk [str]\n  (boolean (some #(= str %) [\"Latte\" \"American With Milk\" \"Cortado\" \"Cappuccino\"])))\n\n\n(defn coffee-has-chocolate [str]\n  (boolean (some #(= str %) [\"Cocoa\" \"Hot Chocolate\"])))\n\n\n(def coffee-names\n  (distinct (apply list (:coffee_name ds))))\n\n\ncoffee-names\n\n\n(\"Latte\"\n \"Hot Chocolate\"\n \"Americano\"\n \"Americano with Milk\"\n \"Cocoa\"\n \"Cortado\"\n \"Espresso\"\n \"Cappuccino\")\n\n\n(def with-features\n  (-&gt; ds\n      (tc/add-column :with-milk\n                     (fn [dataset]\n                       (map\n                        (fn [name] (coffee-has-milk name))\n                        (:coffee_name ds))))\n      (tc/add-column :with-chocolate\n                     (fn [dataset]\n                       (map\n                        (fn [name] (coffee-has-chocolate name))\n                        (:coffee_name ds))))))\n\n\n(def categorical-feature-columns [:coffee_name :with-milk :with-chocolate])\n\n\n(def target-column :cash_type)\n\n\n(map\n #(hash-map\n   :col-name %\n   :values  (distinct (get with-features %)))\n categorical-feature-columns)\n\n\n({:col-name :coffee_name,\n  :values\n  (\"Latte\"\n   \"Hot Chocolate\"\n   \"Americano\"\n   \"Americano with Milk\"\n   \"Cocoa\"\n   \"Cortado\"\n   \"Espresso\"\n   \"Cappuccino\")}\n {:col-name :with-milk, :values (true false)}\n {:col-name :with-chocolate, :values (false true)})\n\n\n(tc/column-names with-features)\n\n\n(:date\n :datetime\n :cash_type\n :card\n :money\n :coffee_name\n :with-milk\n :with-chocolate)\n\n\n(tds/descriptive-stats with-features)\n\n\ndata/index.csv: descriptive-stats [8 12]:\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n:col-name\n:datatype\n:n-valid\n:n-missing\n:min\n:mean\n:mode\n:max\n:standard-deviation\n:skew\n:first\n:last\n\n\n\n\n:date\n:packed-local-date\n1133\n0\n2024-03-01\n2024-05-19\n\n2024-07-31\n3.84601753E+09\n-0.08504978\n2024-03-01\n2024-07-31\n\n\n:datetime\n:string\n1133\n0\n\n\n2024-06-09 15:10:30.692\n\n\n\n2024-03-01 10:15:50.520\n2024-07-31 21:55:16.570\n\n\n:cash_type\n:string\n1133\n0\n\n\ncard\n\n\n\ncard\ncard\n\n\n:card\n:string\n1044\n89\n\n\n\n\n\n\nANON-0000-0000-0001\nANON-0000-0000-0446\n\n\n:money\n:float64\n1133\n0\n18.12\n33.11\n\n40.00\n5.03536551E+00\n-0.55911986\n38.70\n32.82\n\n\n:coffee_name\n:string\n1133\n0\n\n\nAmericano with Milk\n\n\n\nLatte\nLatte\n\n\n:with-milk\n:boolean\n1133\n0\n\n\nfalse\n\n\n\ntrue\ntrue\n\n\n:with-chocolate\n:boolean\n1133\n0\n\n\nfalse\n\n\n\nfalse\nfalse\n\n\n\n\n\n(-&gt; with-features\n    (:with-milk)\n    frequencies)\n\n\n{true 538, false 595}\n\n\n\n0.0.0.3 Preparing the features to be fit into a model\n\n(def relevant-with-features-ds\n  (-&gt; with-features\n      (tc/select-columns (conj categorical-feature-columns target-column))\n      (tds/drop-missing)\n      (tds/categorical-&gt;number [target-column] [\"card\" \"cash\"] :float64)\n      (ds-mod/set-inference-target target-column)))\n\n\n(def cat-maps\n  [\n   (ds-cat/fit-categorical-map relevant-with-features-ds :coffee_name coffee-names :float64)\n   (ds-cat/fit-categorical-map relevant-with-features-ds :with-milk [true false] :float64)\n   (ds-cat/fit-categorical-map relevant-with-features-ds :with-chocolate [true false] :float64)\n   ])\n\n\ncat-maps\n\n\n[{:lookup-table\n  {\"Latte\" 0,\n   \"Hot Chocolate\" 1,\n   \"Americano\" 2,\n   \"Americano with Milk\" 3,\n   \"Cocoa\" 4,\n   \"Cortado\" 5,\n   \"Espresso\" 6,\n   \"Cappuccino\" 7},\n  :src-column :coffee_name,\n  :result-datatype :float64}\n {:lookup-table {true 0, false 1},\n  :src-column :with-milk,\n  :result-datatype :float64}\n {:lookup-table {true 0, false 1},\n  :src-column :with-chocolate,\n  :result-datatype :float64}]\n\n\n(def numeric-ds\n  (reduce (fn [ds cat-map]\n            (ds-cat/transform-categorical-map ds cat-map))\n          relevant-with-features-ds\n          cat-maps))\n\n\n(tc/head numeric-ds 500)\n\n\ndata/index.csv [500 4]:\n\n\n\n:coffee_name\n:with-milk\n:with-chocolate\n:cash_type\n\n\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n1.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n4.0\n1.0\n0.0\n1.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n6.0\n1.0\n1.0\n1.0\n\n\n1.0\n1.0\n0.0\n1.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n1.0\n\n\n1.0\n1.0\n0.0\n1.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n1.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n4.0\n1.0\n0.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n1.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n\n\n\n\n0.0.0.4 Mounting the model\n\n(def split\n  (first\n   (tc/split-&gt;seq numeric-ds :holdout {:seed 112723})))\n\n\nsplit\n\n\n{\n\n\n\n\n\n\n\n\n:train\n\n\n\nGroup: 0 [755 4]:\n\n\n\n:coffee_name\n:with-milk\n:with-chocolate\n:cash_type\n\n\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n1.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n1.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n1.0\n1.0\n0.0\n0.0\n\n\n...\n...\n...\n...\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n6.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n:test\n\n\n\nGroup: 0 [378 4]:\n\n\n\n:coffee_name\n:with-milk\n:with-chocolate\n:cash_type\n\n\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n1.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n1.0\n\n\n...\n...\n...\n...\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n0.0\n\n\n0.0\n0.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n5.0\n0.0\n1.0\n0.0\n\n\n2.0\n1.0\n1.0\n0.0\n\n\n3.0\n1.0\n1.0\n0.0\n\n\n7.0\n0.0\n1.0\n1.0\n\n\n\n\n\n\n\n\n}\n\nhttps://scicloj.github.io/noj/noj_book.ml_basic.html#train-a-model\n\n(def model-with-logistic-regression\n  (ml/train (:train split) {:model-type :smile.classification/logistic-regression}))\n\n\nmodel-with-logistic-regression\n\n\n{:model-data\n {:smile-df-used\n  [coffee_name: double, with-milk: double, with-chocolate: double, cash_type: int]\n+-----------+---------+--------------+---------+\n|coffee_name|with-milk|with-chocolate|cash_type|\n+-----------+---------+--------------+---------+\n|          0|        0|             1|        0|\n|          6|        1|             1|        1|\n|          2|        1|             1|        0|\n|          5|        0|             1|        0|\n|          5|        0|             1|        0|\n|          3|        1|             1|        0|\n|          7|        0|             1|        0|\n|          1|        1|             0|        1|\n|          7|        0|             1|        0|\n|          1|        1|             0|        0|\n+-----------+---------+--------------+---------+\n745 more rows...\n,\n  :smile-props-used\n  {\"smile.logistic.lambda\" \"0.1\", \"smile.logistic.max.iterations\" \"500\", \"smile.logistic.tolerance\" \"1.0E-5\"},\n  :smile-formula-used\n  #object[smile.data.formula.Formula 0x45fb1bf0 \"cash_type ~ coffee_name + with-milk + with-chocolate\"],\n  :model-as-bytes\n  [-84, -19, 0, 5, 115, 114, 0, 48, 115, 109, 105, 108, 101, 46, 99,\n   108, 97, 115, 115, 105, 102, 105, 99, 97, 116, 105, 111, 110, 46,\n   76, 111, 103, 105, 115, 116, 105, 99, 82, 101, 103, 114, 101, 115,\n   115, 105, 111, 110, 36, 66, 105, 110, 111, 109, 105, 97, 108, -92,\n   -95, -106, -117, 126, 118, 16, -86, 2, 0, 1, 91, 0, 1, 119, 116, 0,\n   2, 91, 68, 120, 114, 0, 39, 115, 109, 105, 108, 101, 46, 99, 108,\n   97, 115, 115, 105, 102, 105, 99, 97, 116, 105, 111, 110, 46, 76,\n   111, 103, 105, 115, 116, 105, 99, 82, 101, 103, 114, 101, 115, 115,\n   105, 111, 110, 0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 6, 68, 0, 1, 76, 68, 0,\n   3, 101, 116, 97, 73, 0, 1, 107, 68, 0, 6, 108, 97, 109, 98, 100, 97,\n   73, 0, 1, 112, 76, 0, 6, 108, 97, 98, 101, 108, 115, 116, 0, 19, 76,\n   115, 109, 105, 108, 101, 47, 117, 116, 105, 108, 47, 73, 110, 116,\n   83, 101, 116, 59, 120, 112, -64, 103, -51, -122, 82, 56, -70, 98,\n   63, 33, 92, 75, -82, 89, -20, 16, 0, 0, 0, 2, 63, -71, -103, -103,\n   -103, -103, -103, -102, 0, 0, 0, 3, 115, 114, 0, 17, 115, 109, 105,\n   108, 101, 46, 117, 116, 105, 108, 46, 73, 110, 116, 83, 101, 116, 0,\n   0, 0, 0, 0, 0, 0, 2, 2, 0, 4, 73, 0, 3, 109, 97, 120, 73, 0, 3, 109,\n   105, 110, 76, 0, 5, 105, 110, 100, 101, 120, 116, 0, 15, 76, 106,\n   97, 118, 97, 47, 117, 116, 105, 108, 47, 77, 97, 112, 59, 91, 0, 6,\n   118, 97, 108, 117, 101, 115, 116, 0, 2, 91, 73, 120, 112, 0, 0, 0,\n   1, 0, 0, 0, 0, 115, 114, 0, 17, 106, 97, 118, 97, 46, 117, 116, 105,\n   108, 46, 72, 97, 115, 104, 77, 97, 112, 5, 7, -38, -63, -61, 22, 96,\n   -47, 3, 0, 2, 70, 0, 10, 108, 111, 97, 100, 70, 97, 99, 116, 111,\n   114, 73, 0, 9, 116, 104, 114, 101, 115, 104, 111, 108, 100, 120,\n   112, 63, 64, 0, 0, 0, 0, 0, 12, 119, 8, 0, 0, 0, 16, 0, 0, 0, 2,\n   115, 114, 0, 17, 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 73,\n   110, 116, 101, 103, 101, 114, 18, -30, -96, -92, -9, -127, -121, 56,\n   2, 0, 1, 73, 0, 5, 118, 97, 108, 117, 101, 120, 114, 0, 16, 106, 97,\n   118, 97, 46, 108, 97, 110, 103, 46, 78, 117, 109, 98, 101, 114,\n   -122, -84, -107, 29, 11, -108, -32, -117, 2, 0, 0, 120, 112, 0, 0,\n   0, 0, 113, 0, 126, 0, 13, 115, 113, 0, 126, 0, 11, 0, 0, 0, 1, 113,\n   0, 126, 0, 14, 120, 117, 114, 0, 2, 91, 73, 77, -70, 96, 38, 118,\n   -22, -78, -91, 2, 0, 0, 120, 112, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0,\n   1, 117, 114, 0, 2, 91, 68, 62, -90, -116, 20, -85, 99, 90, 30, 2, 0,\n   0, 120, 112, 0, 0, 0, 4, -65, -82, 44, 43, -63, 63, -123, 111, -65,\n   -37, 49, 103, 77, 71, -111, 61, -65, -63, 118, 51, 15, 91, 85, -31,\n   -64, 0, -86, -53, 91, 32, 50, 123]},\n :options {:model-type :smile.classification/logistic-regression},\n :id #uuid \"8449acf1-a946-446a-89f3-0d36c0186d9a\",\n :feature-columns [:coffee_name :with-milk :with-chocolate],\n :target-columns [:cash_type],\n :target-categorical-maps\n {:cash_type\n  {:lookup-table {\"card\" 0, \"cash\" 1},\n   :src-column :cash_type,\n   :result-datatype :float64}}}\n\n\n(def prediction-with-logistic-regression\n  (ml/predict (:test split) model-with-logistic-regression))\n\n\n\n0.0.0.5 Measuring model accuracy\nAccuracy of a logistic regression\n\n(loss/classification-accuracy\n (:cash_type (ds-cat/reverse-map-categorical-xforms (:test split)))\n (:cash_type (ds-cat/reverse-map-categorical-xforms prediction-with-logistic-regression)))\n\n\n0.9047619047619048\n\n\n(def rf-model\n  (ml/train (:train split) {:model-type :smile.classification/random-forest}))\n\n\n(def rf-prediction\n  (ml/predict (:test split) rf-model))\n\nAccuracy of a random forest model\n\n(loss/classification-accuracy\n (:cash_type (ds-cat/reverse-map-categorical-xforms (:test split)))\n (:cash_type (ds-cat/reverse-map-categorical-xforms rf-prediction)))\n\n\n0.9047619047619048\n\n\n(-&gt;&gt;\n (map\n  (fn [predictor importance]\n    (hash-map :predictor (-&gt; predictor str csk/-&gt;kebab-case-keyword)\n              :importance importance))\n  (-&gt; rf-model ml/thaw-model .formula .predictors)\n  (-&gt; rf-model ml/thaw-model .importance))\n (sort-by :importance)\n reverse)\n\n\n({:predictor :coffee-name, :importance 0.07719322157865996}\n {:predictor :with-chocolate, :importance 0.002974074900820328}\n {:predictor :with-milk, :importance 0.0})\n\nWe conclude that although a model with ~90% accuracy was built. Not a single of it’s features holds a relevant relationship to the target.\nThis means that it’s hard to guess if you will pay cash or card if we know what type of coffee you’re getting. And wether or not it has milk or chocolate in it\n\nsource: src/index.clj",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Fetching data</span>"
    ]
  }
]